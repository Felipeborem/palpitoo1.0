<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Palpitoo - PÃ¡gina Inicial</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Salsa&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="./css/style.css">

  <style>
    /* â”€â”€ Cards de Liga â”€â”€ */
    .card-liga {
      width: 100%;
      max-width: 600px;
      background: var(--card-dark);
      border: 1px solid var(--borda-divisoria);
      border-radius: 20px;
      overflow: hidden;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .card-liga:hover {
      border-color: var(--accent-cyan);
      box-shadow: 0 8px 30px rgba(122, 30, 58, 0.15);
    }

    /* CabeÃ§alho clicÃ¡vel do card */
    .card-liga-header {
      padding: 20px 24px;
      cursor: pointer;
      text-align: center;
    }

    .card-liga-titulo {
      font-family: 'Russo One', sans-serif;
      color: var(--accent-cyan);
      font-size: 17px;
      letter-spacing: 1px;
      text-shadow: 0 0 12px rgba(122, 30, 58, 0.4);
    }

    .card-liga-subtitulo {
      font-family: 'Russo One', sans-serif;
      color: var(--text-white);
      font-size: 13px;
      margin-top: 4px;
      opacity: 0.7;
    }

    .card-liga-divisor {
      width: 100%;
      height: 1px;
      background-image: linear-gradient(to right, var(--borda-divisoria) 50%, transparent 50%);
      background-size: 15px 1px;
      background-repeat: repeat-x;
    }

    .card-liga-status {
      display: inline-block;
      background: var(--bg-dark);
      border: 1px solid var(--borda-divisoria);
      border-radius: 20px;
      padding: 8px 22px;
      font-family: 'Russo One', sans-serif;
      font-size: 13px;
      color: var(--text-white);
      margin: 14px 0;
    }

    /* BotÃ£o de expandir */
    .btn-tabelona {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 12px 24px;
      background: none;
      border: none;
      border-top: 1px dashed var(--borda-divisoria);
      font-family: 'Russo One', sans-serif;
      font-size: 13px;
      color: var(--text-gray);
      cursor: pointer;
      transition: color 0.2s ease, background 0.2s ease;
    }
    .btn-tabelona:hover {
      color: var(--text-white);
      background: rgba(255,255,255,0.03);
    }
    .btn-tabelona .seta {
      transition: transform 0.3s ease;
      display: inline-block;
    }
    .btn-tabelona.aberto .seta {
      transform: rotate(180deg);
    }

    /* Tabela expansÃ­vel */
    .tabelona-expansivel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
      border-top: 0px solid var(--borda-divisoria);
    }
    .tabelona-expansivel.aberto {
      max-height: 600px;
      border-top: 1px dashed var(--borda-divisoria);
    }
    .tabelona-expansivel-inner {
      padding: 16px 20px 20px;
    }

    /* Link "ver pÃ¡gina completa" */
    .link-pagina-completa {
      display: block;
      text-align: center;
      margin-top: 14px;
      font-family: 'Russo One', sans-serif;
      font-size: 12px;
      color: var(--accent-cyan);
      text-decoration: none;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid var(--accent-cyan);
      transition: background 0.2s ease;
    }
    .link-pagina-completa:hover {
      background: rgba(122, 30, 58, 0.15);
    }

    /* Item do ranking dentro da tabelona */
    .rank-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 6px;
      border-radius: 8px;
      transition: background 0.15s ease;
      font-family: 'Russo One', sans-serif;
      font-size: 13px;
    }
    .rank-item:hover { background: var(--bg-dark); }
    .rank-item.rank-eu { background: rgba(122,30,58,0.1); border: 1px solid var(--accent-cyan); }
    .quadrado { width: 12px; height: 12px; border-radius: 3px; flex-shrink: 0; }
    .verde   { background: var(--accent-green); }
    .amarelo { background: #eab308; }
    .laranja { background: #f97316; }
    .vermelho{ background: var(--vermelho); }
  </style>
</head>
<body>

  <header class="navbar">
    <a href="index.html" class="logo-link">
      <img src="./img/pato.png" alt="Logo Palpitoo" class="logo-imagem">
    </a>
    <nav>
      <ul class="nav-links">
        <li><a href="index.html" class="ativo">InÃ­cio</a></li>
        <li><a href="ligas.html">Ligas</a></li>
        <li><a href="palpites.html">Palpites</a></li>
        <li><a href="novidades.html">Novidades</a></li>
        <li><a href="social.html">Social</a></li>
        <li><a href="carreira.html">Carreira</a></li>
      </ul>
    </nav>
  </header>

  <main class="container-principal dashboard-layout">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR ESQUERDA â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <aside class="cartao bg-claro cartao-perfil animacao-suave">

      <div class="perfil-topo" style="display:flex;flex-direction:column;align-items:center;">
        <img src="https://via.placeholder.com/80" alt="Foto" id="fotoPerfil"
             class="foto-perfil" style="width:80px;height:80px;border-radius:50%;object-fit:cover;">
        <h2 class="font-russo titulo-azul" id="textoNome">Carregando...</h2>
        <p class="font-russo text-gray-600 mt-5" style="font-size:0.9em;">
          Time: <span id="textoTime" style="color:var(--accent-cyan);">Nenhum</span>
        </p>
      </div>

      <hr class="linha-divisoria mt-15 mb-15">

      <h3 class="font-russo titulo-azul">Desempenho na temporada</h3>
      <ul class="lista-desempenho mt-10">
        <li>
          <span class="icone">ğŸ¯</span>
          <strong id="stat-cravadas">0</strong>
          <span style="font-size:0.7em;color:gray;margin-left:5px;">CravaÃ§Ãµes (3pts)</span>
        </li>
        <li>
          <span class="icone">âœ”ï¸</span>
          <strong id="stat-acertos">0</strong>
          <span style="font-size:0.7em;color:gray;margin-left:5px;">Acertos (1pt)</span>
        </li>
        <li>
          <span class="icone">âœ–ï¸</span>
          <strong id="stat-erros">0</strong>
          <span style="font-size:0.7em;color:gray;margin-left:5px;">Erros (0pt)</span>
        </li>
      </ul>

      <h3 class="font-russo titulo-azul mt-20">Aproveitamento</h3>
      <div class="aproveitamento-box mt-10">
        <span class="icone-grande" id="icone-aproveitamento">â³</span>
        <p><strong id="texto-aproveitamento">Calculando...<br>--% de acerto</strong></p>
      </div>

      <hr class="linha-divisoria final-linha">

      <a href="carreira.html" class="perfil-rodape font-russo" style="text-decoration:none;display:flex;">
        <span class="icone">âš™ï¸</span>
        <span class="texto-hover">Alterar Perfil</span>
      </a>

    </aside>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• COLUNA CENTRAL â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div style="display:flex;flex-direction:column;align-items:center;width:100%;gap:20px;">

      <!-- â”€â”€ CARD: GLOBAL LEAGUE â”€â”€ -->
      <div class="card-liga">

        <div class="card-liga-header">
          <div class="card-liga-divisor" style="margin-bottom:14px;"></div>
          <p class="card-liga-titulo">âšœï¸ GLOBAL - LEAGUE âšœï¸</p>
          <p class="card-liga-subtitulo">- (RANKING GERAL) -</p>
          <div class="card-liga-divisor" style="margin-top:14px;margin-bottom:10px;"></div>
          <span class="card-liga-status" id="status-global">ğŸ‘‘ Status: TOP 8 CRAQUES</span>
          <div class="card-liga-divisor" style="margin-top:10px;"></div>
        </div>

        <button class="btn-tabelona" id="btn-global" onclick="toggleTabelona('global')">
          <span class="seta">â¬‡ï¸</span> Tabelona <span class="seta">â¬‡ï¸</span>
        </button>

        <div class="tabelona-expansivel" id="tabela-global">
          <div class="tabelona-expansivel-inner">
            <ul id="lista-global" style="list-style:none;padding:0;">
              <li class="rank-item" style="justify-content:center;color:var(--text-gray);">
                Carregando... ğŸ”„
              </li>
            </ul>
            <a href="ligas.html" class="link-pagina-completa">
              Ver Tabela Completa â†’
            </a>
          </div>
        </div>

      </div>

      <!-- â”€â”€ CARD: MINHA LIGA â”€â”€ -->
      <div class="card-liga">

        <div class="card-liga-header">
          <div class="card-liga-divisor" style="margin-bottom:14px;"></div>
          <p class="card-liga-titulo" id="titulo-minha-liga">âšœï¸ MINHA LIGA âšœï¸</p>
          <p class="card-liga-subtitulo">- (RANKING PRIVADO) -</p>
          <div class="card-liga-divisor" style="margin-top:14px;margin-bottom:10px;"></div>
          <span class="card-liga-status" id="status-minha-liga">ğŸ”¥ Status: TOP 8 DA LIGA</span>
          <div class="card-liga-divisor" style="margin-top:10px;"></div>
        </div>

        <button class="btn-tabelona" id="btn-minha-liga" onclick="toggleTabelona('minha-liga')">
          <span class="seta">â¬‡ï¸</span> Tabelona da Liga <span class="seta">â¬‡ï¸</span>
        </button>

        <div class="tabelona-expansivel" id="tabela-minha-liga">
          <div class="tabelona-expansivel-inner">
            <ul id="lista-minha-liga" style="list-style:none;padding:0;">
              <li class="rank-item" style="justify-content:center;color:var(--text-gray);">
                Procurando sua liga secreta... ğŸ•µï¸â€â™‚ï¸
              </li>
            </ul>
            <a href="minhaliga.html" class="link-pagina-completa" id="link-minha-liga">
              Ver PÃ¡gina da Liga â†’
            </a>
          </div>
        </div>

      </div>

    </div>
    <!-- fim coluna central -->

    <aside class="coluna-destaques"></aside>

  </main>

  <div id="container-avisos"></div>

<script>
  // â”€â”€ DADOS DO USUÃRIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const nomeLogado = localStorage.getItem('nome_craque');
  const timeLogado = localStorage.getItem('time_craque');
  const fotoLogada = localStorage.getItem('foto_craque');
  const idLogado   = localStorage.getItem('craqueId') || localStorage.getItem('id_craque');

  if (nomeLogado) {
    document.getElementById('textoNome').innerText = nomeLogado;
    if (timeLogado && timeLogado !== 'undefined') {
      document.getElementById('textoTime').innerText = timeLogado;
    }
  }
  if (fotoLogada && fotoLogada !== 'undefined' && fotoLogada !== 'null') {
    document.getElementById('fotoPerfil').src = fotoLogada;
  }

  // â”€â”€ TOGGLE TABELONA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function toggleTabelona(qual) {
    const tabela = document.getElementById(`tabela-${qual}`);
    const btn    = document.getElementById(`btn-${qual}`);
    const aberto = tabela.classList.contains('aberto');

    tabela.classList.toggle('aberto', !aberto);
    btn.classList.toggle('aberto', !aberto);

    // Muda o emoji da seta quando aberto
    const setas = btn.querySelectorAll('.seta');
    setas.forEach(s => s.innerText = aberto ? 'â¬‡ï¸' : 'â¬†ï¸');
  }

  // â”€â”€ DESEMPENHO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function calcularDesempenho() {
    if (!idLogado) return;
    try {
      const resposta = await fetch(`https://palpitoo-api.onrender.com/meus-palpites/${idLogado}`);
      const palpites = await resposta.json();

      let cravadas = 0, acertos = 0, erros = 0, finalizados = 0;

      palpites.forEach(p => {
        if (p.pontos_obtidos !== null) {
          finalizados++;
          if (p.pontos_obtidos === 3) cravadas++;
          else if (p.pontos_obtidos === 1) acertos++;
          else erros++;
        }
      });

      document.getElementById('stat-cravadas').innerText = cravadas;
      document.getElementById('stat-acertos').innerText  = acertos;
      document.getElementById('stat-erros').innerText    = erros;

      if (finalizados > 0) {
        const taxa = Math.round(((cravadas + acertos) / finalizados) * 100);
        let icone = 'ğŸ‘', frase = 'Bom jogador,';
        if (taxa >= 70) { icone = 'ğŸ”¥'; frase = 'TÃ¡ voando!,'; }
        else if (taxa < 40) { icone = 'ğŸ¦†'; frase = 'Pato master,'; }
        document.getElementById('icone-aproveitamento').innerText = icone;
        document.getElementById('texto-aproveitamento').innerHTML = `${frase}<br>${taxa}% de acerto`;
      } else {
        document.getElementById('icone-aproveitamento').innerText = 'âš½';
        document.getElementById('texto-aproveitamento').innerHTML = 'Sem jogos<br>encerrados ainda';
      }
    } catch (e) {
      document.getElementById('texto-aproveitamento').innerHTML = 'Erro de conexÃ£o';
    }
  }

  // â”€â”€ RANKING GLOBAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function carregarRankingGlobal() {
    try {
      const res      = await fetch('https://palpitoo-api.onrender.com/ranking');
      const jogadores = await res.json();
      const ul       = document.getElementById('lista-global');
      ul.innerHTML   = '';

      if (!jogadores.length) {
        ul.innerHTML = '<li class="rank-item" style="justify-content:center;color:var(--text-gray);">Nenhum palpite computado ainda. ğŸ¦†</li>';
        return;
      }

      const cores = ['verde','verde','verde','amarelo','amarelo','laranja','vermelho','vermelho'];
      jogadores.slice(0, 8).forEach((j, i) => {
        const ehEu = String(j.id) === String(idLogado);
        const nome = j.nome.split(' ')[0].toUpperCase();
        ul.innerHTML += `
          <li class="rank-item ${ehEu ? 'rank-eu' : ''}">
            <span class="quadrado ${cores[i] || 'vermelho'}"></span>
            <span style="color:var(--text-gray);min-width:24px;">${i+1}Âº</span>
            <span style="flex-grow:1;color:${ehEu ? 'var(--accent-cyan)' : 'var(--text-white)'};">${nome} ${ehEu ? '(vocÃª)' : ''}</span>
            <span style="color:var(--accent-cyan);">${j.total_pontos} pts</span>
          </li>`;
      });

      // Atualiza o status com a posiÃ§Ã£o do usuÃ¡rio
      if (idLogado) {
        const pos = jogadores.findIndex(j => String(j.id) === String(idLogado));
        if (pos !== -1) {
          document.getElementById('status-global').innerText = `ğŸ‘‘ Status: ${pos + 1}Âº LUGAR GERAL`;
        }
      }
    } catch (e) {
      document.getElementById('lista-global').innerHTML =
        '<li class="rank-item" style="justify-content:center;color:#f87171;">Erro ao conectar com a CBF.</li>';
    }
  }

  // â”€â”€ RANKING MINHA LIGA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function carregarRankingMinhaLiga() {
    if (!idLogado) return;
    try {
      const resLigas = await fetch(`https://palpitoo-api.onrender.com/minhas-ligas/${idLogado}`);
      const ligas    = await resLigas.json();
      const ul       = document.getElementById('lista-minha-liga');

      if (!ligas.length) {
        ul.innerHTML = `
          <li class="rank-item" style="justify-content:center;flex-direction:column;gap:8px;text-align:center;color:var(--text-gray);">
            VocÃª nÃ£o estÃ¡ em nenhuma liga ainda. ğŸ¦†
            <a href="minhaliga.html" style="color:var(--accent-cyan);font-size:12px;text-decoration:underline;">Criar ou entrar em uma</a>
          </li>`;
        document.getElementById('titulo-minha-liga').innerText = 'âšœï¸ SEM LIGA âšœï¸';
        document.getElementById('status-minha-liga').innerText = 'ğŸ¦† Sem Liga';
        return;
      }

      const idLiga    = ligas[0].id_liga;
      const resRanking = await fetch(`https://palpitoo-api.onrender.com/ranking-liga/${idLiga}`);
      const dadosLiga  = await resRanking.json();

      document.getElementById('titulo-minha-liga').innerText = `âšœï¸ ${dadosLiga.nomeLiga.toUpperCase()} âšœï¸`;
      document.getElementById('link-minha-liga').href = `minhaliga.html?id=${idLiga}`;
      ul.innerHTML = '';

      if (!dadosLiga.ranking.length) {
        ul.innerHTML = '<li class="rank-item" style="justify-content:center;color:var(--text-gray);">NinguÃ©m pontuou ainda.</li>';
        return;
      }

      const cores = ['verde','verde','verde','amarelo','amarelo','laranja','vermelho','vermelho'];
      dadosLiga.ranking.slice(0, 8).forEach((j, i) => {
        const ehEu = String(j.id) === String(idLogado);
        const nome = j.nome.split(' ')[0].toUpperCase();
        ul.innerHTML += `
          <li class="rank-item ${ehEu ? 'rank-eu' : ''}">
            <span class="quadrado ${cores[i] || 'vermelho'}"></span>
            <span style="color:var(--text-gray);min-width:24px;">${i+1}Âº</span>
            <span style="flex-grow:1;color:${ehEu ? 'var(--accent-cyan)' : 'var(--text-white)'};">${nome} ${ehEu ? '(vocÃª)' : ''}</span>
            <span style="color:var(--accent-cyan);">${j.total_pontos} pts</span>
          </li>`;
      });

      // Atualiza status com posiÃ§Ã£o na liga
      const pos = dadosLiga.ranking.findIndex(j => String(j.id) === String(idLogado));
      if (pos !== -1) {
        document.getElementById('status-minha-liga').innerText = `ğŸ”¥ Status: ${pos + 1}Âº DA LIGA`;
      }

    } catch (e) {
      document.getElementById('lista-minha-liga').innerHTML =
        '<li class="rank-item" style="justify-content:center;color:#f87171;">Erro ao buscar sua liga.</li>';
    }
  }

  // â”€â”€ INICIAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  calcularDesempenho();
  carregarRankingGlobal();
  carregarRankingMinhaLiga();
</script>

</body>
</html>