<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Palpitoo - Palpites</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Salsa&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css">

  <style>
    /* â”€â”€ LINHA DE JOGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .linha-jogo {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 12px;
      padding: 14px 10px;
      border-radius: 12px;
      border: 1px solid var(--borda-divisoria);
      background: var(--bg-dark);
      margin-bottom: 10px;
      transition: border-color 0.2s ease;
    }
    .linha-jogo:hover { border-color: var(--accent-cyan); }
    .linha-jogo.finalizado {
      opacity: 0.6;
      border-color: #f87171;
    }

    /* â”€â”€ NOMES DOS TIMES â”€â”€ */
    .nome-time {
      font-family: 'Russo One', sans-serif;
      font-size: 13px;
      color: var(--text-white);
      line-height: 1.3;
      word-break: break-word;
    }
    .time-casa { text-align: right; }
    .time-fora { text-align: left; }

    /* â”€â”€ ÃREA DO PLACAR â”€â”€ */
    .area-placar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-shrink: 0;
    }

    /* â”€â”€ INPUT PLACAR â”€â”€ */
    .input-placar {
      width: 48px;
      height: 48px;
      text-align: center;
      font-family: 'Russo One', sans-serif;
      font-size: 18px;
      color: var(--text-white);
      background: var(--bg-escuro, #111827);
      border: 2px solid var(--borda-divisoria);
      border-radius: 10px;
      outline: none;
      box-sizing: border-box;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      /* Remove setas do input number */
      -moz-appearance: textfield;
    }
    .input-placar::-webkit-outer-spin-button,
    .input-placar::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .input-placar:focus {
      border-color: var(--accent-cyan);
      box-shadow: 0 0 0 3px rgba(var(--accent-cyan-rgb, 122,30,58), 0.15);
    }
    .input-placar:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      border-color: #f87171;
    }

    /* â”€â”€ DISPLAY PLACAR (comprovante) â”€â”€ */
    .placar-display {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Russo One', sans-serif;
      font-size: 18px;
      color: var(--text-white);
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 10px;
      box-sizing: border-box;
    }

    .versus {
      font-family: 'Russo One', sans-serif;
      font-size: 16px;
      color: var(--text-gray);
      flex-shrink: 0;
    }

    /* â”€â”€ AVISO JOGO ENCERRADO â”€â”€ */
    .aviso-encerrado {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-family: 'Russo One', sans-serif;
      font-size: 10px;
      color: #f87171;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    /* â”€â”€ TÃTULO DE RODADA â”€â”€ */
    .titulo-rodada {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 20px 0 12px;
    }
    .titulo-rodada::before,
    .titulo-rodada::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--borda-divisoria);
    }
    .titulo-rodada span {
      font-family: 'Russo One', sans-serif;
      font-size: 13px;
      color: var(--accent-cyan);
      text-transform: uppercase;
      letter-spacing: 2px;
      white-space: nowrap;
    }

    /* â”€â”€ BANNER DE ESTADO DA RODADA â”€â”€ */
    .banner-rodada {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      border-radius: 14px;
      padding: 14px 20px;
      margin-bottom: 16px;
    }
    .banner-rodada.aberta {
      background: rgba(122, 30, 58, 0.1);
      border: 1px solid var(--accent-cyan);
    }
    .banner-rodada.ao-vivo {
      background: rgba(239, 68, 68, 0.08);
      border: 1px solid #ef4444;
      animation: pulso-vivo 2s infinite ease-in-out;
    }
    .banner-rodada.encerrada {
      background: rgba(100,100,100,0.06);
      border: 1px solid #374151;
    }
    @keyframes pulso-vivo {
      0%,100% { box-shadow: 0 0 0 0 rgba(239,68,68,0); }
      50%      { box-shadow: 0 0 0 6px rgba(239,68,68,0.12); }
    }
    .banner-label {
      font-family: 'Russo One', sans-serif;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .banner-rodada.aberta  .banner-label  { color: var(--text-gray); }
    .banner-rodada.ao-vivo .banner-label  { color: #ef4444; }
    .banner-rodada.encerrada .banner-label{ color: #6b7280; }
    .banner-sub {
      font-size: 11px;
      color: var(--text-gray);
      margin-top: 3px;
    }
    .banner-timer {
      font-family: 'Russo One', sans-serif;
      font-size: 22px;
      letter-spacing: 2px;
    }
    .banner-rodada.aberta   .banner-timer { color: var(--accent-cyan); }
    .banner-rodada.ao-vivo  .banner-timer { color: #ef4444; }
    .banner-rodada.encerrada .banner-timer{ color: #6b7280; }
    .dot-vivo {
      display: inline-block; width: 8px; height: 8px;
      background: #ef4444; border-radius: 50%;
      margin-right: 5px; vertical-align: middle;
      animation: pisca 1s infinite;
    }
    @keyframes pisca { 0%,100%{opacity:1} 50%{opacity:0.2} }

    /* â”€â”€ STATUS BADGE â”€â”€ */
    .status-badge {
      font-family: 'Russo One', sans-serif;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 3px 8px;
      border-radius: 6px;
      white-space: nowrap;
    }
    .status-badge.aberto     { background: rgba(74,222,128,0.12); color: #4ade80; border: 1px solid rgba(74,222,128,0.3); }
    .status-badge.andamento  { background: rgba(250,204,21,0.12); color: #facc15; border: 1px solid rgba(250,204,21,0.3); }
    .status-badge.finalizado { background: rgba(248,113,113,0.12); color: #f87171; border: 1px solid rgba(248,113,113,0.3); }

    /* â”€â”€ ÃREA CENTRAL DO COMPROVANTE â”€â”€ */
    .centro-comprovante {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    /* â”€â”€ PONTOS OBTIDOS â”€â”€ */
    .pontos-obtidos {
      font-family: 'Russo One', sans-serif;
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 8px;
    }
    .pontos-obtidos.exato    { background: rgba(34,197,94,0.15);  color: #22c55e; }
    .pontos-obtidos.vencedor { background: rgba(234,179,8,0.15);  color: #eab308; }
    .pontos-obtidos.errou    { background: rgba(248,113,113,0.15);color: #f87171; }

    /* â”€â”€ DIVISOR â”€â”€ */
    .divisor-jogo {
      border: none;
      border-top: 1px dashed var(--borda-divisoria);
      margin: 6px 8% 16px;
    }

    /* â”€â”€ BOTÃ•ES â”€â”€ */
    .botoes-acao {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    .botoes-acao .btn { flex: 1; min-width: 120px; max-width: 200px; }

    /* â”€â”€ MOBILE â”€â”€ */
    @media (max-width: 480px) {
      .linha-jogo {
        grid-template-columns: 1fr auto 1fr;
        gap: 8px;
        padding: 12px 8px;
      }
      .nome-time { font-size: 11px; }
      .input-placar, .placar-display { width: 42px; height: 42px; font-size: 16px; }
      .botoes-acao .btn { max-width: 100%; }
    }
  </style>
</head>
<body>

  <header class="navbar">
    <a href="inicio.html" class="logo-link">
      <img src="./img/pato.png" alt="Logo Palpitoo" class="logo-imagem">
    </a>
    <nav>
      <ul class="nav-links">
        <li><a href="index.html">InÃ­cio</a></li>
        <li><a href="ligas.html">Ligas</a></li>
        <li><a href="palpites.html" class="ativo">Palpites</a></li>
        <li><a href="novidades.html">Novidades</a></li>
        <li><a href="social.html">Social</a></li>
        <li><a href="carreira.html">Carreira</a></li>
      </ul>
    </nav>
  </header>

  <main class="container-principal container-palpites">

    <!-- CARD: FAZER PALPITES -->
    <section class="cartao bg-escuro cartao-palpite animacao-suave">
      <div class="cabecalho-palpite mb-20">
        <h2 class="font-russo titulo-branco text-center">Palpites da Rodada</h2>
        <p class="subtitulo-tempo text-center">Deixe seus palpites para os prÃ³ximos jogos</p>
      </div>

      <div class="lista-jogos" id="container-jogos">
        <p class="text-center font-russo mt-10" style="color: var(--text-gray);">Buscando tabela de jogos... ğŸ”„</p>
      </div>

      <div class="botoes-acao mt-20">
        <button class="btn btn-cancelar font-russo" onclick="limparPalpites()">Limpar</button>
        <button class="btn btn-salvar font-russo"   onclick="enviarTodosPalpites()">Salvar Palpites</button>
      </div>
    </section>

    <!-- CARD: COMPROVANTES -->
    <section class="cartao bg-escuro cartao-palpite animacao-suave mt-20">
      <div class="cabecalho-palpite mb-20">
        <h2 class="font-russo titulo-branco text-center">Meus Palpites Registrados</h2>
        <p class="subtitulo-tempo text-center">Acompanhe o andamento das partidas</p>
      </div>
      <div class="lista-jogos" id="resumo-palpites">
        <p class="text-center font-russo mt-10" style="color: var(--text-gray);">Buscando seus comprovantes... ğŸ”„</p>
      </div>
    </section>

  </main>

  <!-- TOASTS -->
  <div id="container-avisos"></div>

<script>
  let jogosCarregados = [];

  // â”€â”€ TOAST (substitui alert()) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function mostrarAviso(msg, tipo = 'info') {
    const cont  = document.getElementById('container-avisos');
    const toast = document.createElement('div');
    const icone = tipo === 'sucesso' ? 'âœ…' : tipo === 'erro' ? 'âŒ' : 'â„¹ï¸';
    toast.className = `aviso-toast aviso-${tipo}`;
    toast.innerHTML = `<span>${icone}</span><span>${msg}</span>`;
    cont.appendChild(toast);
    setTimeout(() => {
      toast.classList.add('aviso-saindo');
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  // â”€â”€ STATUS BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function statusBadge(status) {
    const s = status.toLowerCase();
    if (s === 'finalizado')  return `<span class="status-badge finalizado">ğŸ”’ Finalizado</span>`;
    if (s === 'em andamento') return `<span class="status-badge andamento">ğŸŸ¡ Em andamento</span>`;
    return `<span class="status-badge aberto">ğŸŸ¢ Aberto</span>`;
  }

  // â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function formatarDataHora(iso) {
    if (!iso) return null;
    const d = new Date(iso);
    return d.toLocaleString('pt-BR', { day:'2-digit', month:'2-digit', hour:'2-digit', minute:'2-digit' });
  }
  function formatarCountdown(ms) {
    if (ms <= 0) return '00:00:00';
    const s    = Math.floor(ms / 1000);
    const dias  = Math.floor(s / 86400);
    const horas = Math.floor((s % 86400) / 3600);
    const min   = Math.floor((s % 3600) / 60);
    const seg   = s % 60;
    if (dias > 0) return `${dias}d ${String(horas).padStart(2,'0')}:${String(min).padStart(2,'0')}`;
    return `${String(horas).padStart(2,'0')}:${String(min).padStart(2,'0')}:${String(seg).padStart(2,'0')}`;
  }

  // Busca o prazo de uma rodada:
  // 1. Do campo prazo_rodada retornado pela API (ideal)
  // 2. Fallback: localStorage (salvo pelo admin)
  function getPrazoRodada(numeroRodada, jogosRodada) {
    // Tenta pegar do primeiro jogo que tenha prazo_rodada
    const comPrazo = jogosRodada.find(j => j.prazo_rodada);
    if (comPrazo) return new Date(comPrazo.prazo_rodada).getTime();
    // Fallback: localStorage (definido pelo painel admin)
    const prazos = JSON.parse(localStorage.getItem('prazos_rodadas') || '{}');
    const prazoStr = prazos[String(numeroRodada)];
    return prazoStr ? new Date(prazoStr).getTime() : null;
  }

  // Retorna o estado atual da rodada: 'aberta' | 'ao_vivo' | 'encerrada'
  function estadoRodada(numeroRodada, jogosRodada) {
    const statuses = jogosRodada.map(j => j.status.toLowerCase());

    // Todos finalizados â†’ encerrada
    if (statuses.every(s => s === 'finalizado')) return 'encerrada';

    // Qualquer jogo em andamento ou finalizado â†’ ao vivo
    if (statuses.some(s => s === 'em andamento' || s === 'finalizado')) return 'ao_vivo';

    // Prazo expirou â†’ ao vivo
    const prazo = getPrazoRodada(numeroRodada, jogosRodada);
    if (prazo && Date.now() >= prazo) return 'ao_vivo';

    return 'aberta';
  }

  function rodadaBloqueada(numeroRodada, jogosRodada) {
    return estadoRodada(numeroRodada, jogosRodada) !== 'aberta';
  }

  // â”€â”€ BANNER DE ESTADO DA RODADA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const _timers = {};
  function renderBannerRodada(containerId, numeroRodada, jogosRodada) {
    const bannerId  = `banner-${containerId}`;
    const container = document.getElementById(containerId);
    if (!container) return;

    if (_timers[bannerId]) { clearInterval(_timers[bannerId]); delete _timers[bannerId]; }
    const antigo = document.getElementById(bannerId);
    if (antigo) antigo.remove();

    const banner = document.createElement('div');
    banner.id = bannerId;

    function bloquearInputs() {
      jogosRodada.forEach(j => {
        const iC = document.getElementById(`casa_${j.id_jogo}`);
        const iF = document.getElementById(`fora_${j.id_jogo}`);
        if (iC) iC.disabled = true;
        if (iF) iF.disabled = true;
      });
    }

    function atualizar() {
      const estado = estadoRodada(numeroRodada, jogosRodada);
      const prazo  = getPrazoRodada(numeroRodada, jogosRodada);

      if (estado === 'encerrada') {
        banner.className = 'banner-rodada encerrada';
        banner.innerHTML = `<div><p class="banner-label">ğŸ Rodada Encerrada</p><p class="banner-sub">Todos os jogos foram finalizados.</p></div><span class="banner-timer">FIM</span>`;
        bloquearInputs();
        clearInterval(_timers[bannerId]);

      } else if (estado === 'ao_vivo') {
        banner.className = 'banner-rodada ao-vivo';
        const vivos = jogosRodada.filter(j => j.status.toLowerCase() === 'em andamento').length;
        banner.innerHTML = `<div><p class="banner-label"><span class="dot-vivo"></span>Rodada ao Vivo</p><p class="banner-sub">Palpites encerrados${vivos ? ` Â· ${vivos} jogo(s) rolando` : ''}</p></div><span class="banner-timer">AO VIVO</span>`;
        bloquearInputs();
        clearInterval(_timers[bannerId]);

      } else if (prazo) {
        // aberta com prazo definido â†’ countdown
        const restante = prazo - Date.now();
        if (restante <= 0) { atualizar(); return; }
        banner.className = 'banner-rodada aberta';
        banner.innerHTML = `<div><p class="banner-label">â° Mercado fecha em</p><p class="banner-sub">ApÃ³s este tempo, nenhum palpite Ã© aceito</p></div><span class="banner-timer">${formatarCountdown(restante)}</span>`;

      } else {
        // aberta sem prazo â†’ nÃ£o mostra banner
        banner.remove();
        return;
      }
    }

    atualizar();
    if (!document.getElementById(bannerId)) {
      container.insertBefore(banner, container.firstChild);
    }

    const estado = estadoRodada(numeroRodada, jogosRodada);
    if (estado === 'aberta') {
      _timers[bannerId] = setInterval(atualizar, 1000);
    }
  }

  // â”€â”€ HELPER: MONTA HTML DE UM JOGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function htmlJogo(jogo, bloqueado = false) {
    const s = jogo.status.toLowerCase();
    const finalizado   = s === 'finalizado';
    const emAndamento  = s === 'em andamento';
    const desabilitado = finalizado || emAndamento || bloqueado;

    // Centro: se finalizado mostra placar real; senÃ£o mostra inputs
    let centro;
    if (finalizado) {
      centro = `
        <div style="display:flex;flex-direction:column;align-items:center;gap:4px;">
          <span class="status-badge finalizado">ğŸ”’ Finalizado</span>
          <div style="display:flex;align-items:center;gap:6px;background:rgba(107,114,128,.15);border:1px solid #374151;border-radius:10px;padding:6px 12px;">
            <span style="font-family:'Russo One',sans-serif;font-size:20px;color:#9ca3af;">${jogo.gols_casa_real ?? '?'}</span>
            <span style="font-size:13px;color:#4b5563;">x</span>
            <span style="font-family:'Russo One',sans-serif;font-size:20px;color:#9ca3af;">${jogo.gols_fora_real ?? '?'}</span>
          </div>
        </div>`;
    } else if (emAndamento) {
      centro = `
        <div style="display:flex;flex-direction:column;align-items:center;gap:4px;">
          <span class="status-badge andamento">ğŸŸ¡ Ao Vivo</span>
          <div class="area-placar">
            <input type="number" id="casa_${jogo.id_jogo}" class="input-placar font-russo" placeholder="0" min="0" disabled>
            <span class="versus">x</span>
            <input type="number" id="fora_${jogo.id_jogo}" class="input-placar font-russo" placeholder="0" min="0" disabled>
          </div>
        </div>`;
    } else {
      centro = `
        <div class="area-placar">
          <input type="number" id="casa_${jogo.id_jogo}" class="input-placar font-russo" placeholder="0" min="0" ${desabilitado ? 'disabled' : ''}>
          <span class="versus">x</span>
          <input type="number" id="fora_${jogo.id_jogo}" class="input-placar font-russo" placeholder="0" min="0" ${desabilitado ? 'disabled' : ''}>
        </div>`;
    }

    return `
      <div class="linha-jogo ${finalizado ? 'finalizado' : ''}">
        <span class="nome-time time-casa">${jogo.time_casa}</span>
        ${centro}
        <span class="nome-time time-fora">${jogo.time_fora}</span>
      </div>`;
  }

  // â”€â”€ DETECTA RODADA ATUAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Prioridade: ao vivo > aberta > mais recente
  function detectarRodadaAtual(porRodada) {
    const todas = Object.keys(porRodada).map(Number).sort((a, b) => a - b);

    // 1. Alguma rodada ao vivo (tem jogo em andamento)?
    for (const r of todas) {
      if (porRodada[r].some(j => j.status.toLowerCase() === 'em andamento')) return r;
    }
    // 2. Primeira rodada com jogos nÃ£o finalizados
    for (const r of todas) {
      if (porRodada[r].some(j => j.status.toLowerCase() !== 'finalizado')) return r;
    }
    // 3. Fallback: Ãºltima rodada
    return todas[todas.length - 1];
  }

  // 1. CARREGAR E DESENHAR OS JOGOS POR RODADA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function carregarJogos() {
    try {
      const resposta  = await fetch('https://palpitoo-api.onrender.com/jogos');
      jogosCarregados = await resposta.json();
      const container = document.getElementById('container-jogos');
      container.innerHTML = '';

      if (!jogosCarregados.length) {
        container.innerHTML = '<p class="text-center font-russo mt-10" style="color:var(--text-gray);">Nenhum jogo liberado ainda.</p>';
        return;
      }

      // Agrupa por rodada
      const porRodada = {};
      jogosCarregados.forEach(j => {
        const r = j.rodada || 1;
        if (!porRodada[r]) porRodada[r] = [];
        porRodada[r].push(j);
      });

      const todasRodadas   = Object.keys(porRodada).map(Number).sort((a, b) => a - b);
      const rodadaAtual    = detectarRodadaAtual(porRodada);
      const rodadasAntes   = todasRodadas.filter(r => r < rodadaAtual);

      // â”€â”€ RODADA ATUAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const bloqueadaAtual = rodadaBloqueada(rodadaAtual, porRodada[rodadaAtual]);
      container.innerHTML += `
        <div class="titulo-rodada"><span>ğŸ† Rodada ${rodadaAtual} â€” Atual</span></div>
        <div id="jogos-rodada-${rodadaAtual}"></div>`;

      let htmlJogosAtual = '';
      porRodada[rodadaAtual].forEach(j => { htmlJogosAtual += htmlJogo(j, bloqueadaAtual); });
      document.getElementById(`jogos-rodada-${rodadaAtual}`).innerHTML = htmlJogosAtual;

      // Banner de estado (countdown / ao vivo / encerrada)
      renderBannerRodada(`jogos-rodada-${rodadaAtual}`, rodadaAtual, porRodada[rodadaAtual]);

      // â”€â”€ BOTÃƒO + PAINEL RODADAS ANTERIORES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      if (rodadasAntes.length > 0) {
        container.innerHTML += `
          <div style="text-align:center; margin-top:24px;">
            <button
              id="btn-anteriores"
              onclick="toggleRodadasAnteriores()"
              class="btn btn-cancelar font-russo"
              style="font-size:12px; padding:10px 24px; width:100%; border-style:dashed; opacity:0.7;">
              âª Ver Rodadas Anteriores (${rodadasAntes.length})
            </button>
          </div>
          <div id="rodadas-anteriores" style="display:none; margin-top:8px;"></div>`;
      }

      puxarPalpitesSalvos();
    } catch (err) {
      console.error('Erro:', err);
      document.getElementById('container-jogos').innerHTML =
        '<p class="text-center font-russo mt-10" style="color:#f87171;">Erro ao conectar com o servidor.</p>';
    }
  }

  // â”€â”€ TOGGLE RODADAS ANTERIORES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let anterioresCarregadas = false;
  function toggleRodadasAnteriores() {
    const painel = document.getElementById('rodadas-anteriores');
    const btn    = document.getElementById('btn-anteriores');
    const aberto = painel.style.display !== 'none';

    if (aberto) {
      painel.style.display = 'none';
      const porRodada = {};
      jogosCarregados.forEach(j => { const r = j.rodada||1; if(!porRodada[r]) porRodada[r]=[]; porRodada[r].push(j); });
      const total = Object.keys(porRodada).map(Number).filter(r => r < detectarRodadaAtual(porRodada)).length;
      btn.innerHTML = `âª Ver Rodadas Anteriores (${total})`;
      return;
    }

    painel.style.display = 'block';
    btn.innerHTML = 'ğŸ”¼ Ocultar Rodadas Anteriores';

    if (anterioresCarregadas) return;
    anterioresCarregadas = true;

    const porRodada = {};
    jogosCarregados.forEach(j => {
      const r = j.rodada || 1;
      if (!porRodada[r]) porRodada[r] = [];
      porRodada[r].push(j);
    });

    const todasRodadas   = Object.keys(porRodada).map(Number).sort((a, b) => a - b);
    const rodadaAtual    = detectarRodadaAtual(porRodada);
    const rodadasAntes   = todasRodadas.filter(r => r < rodadaAtual).reverse(); // mais recente primeiro

    let html = '';
    rodadasAntes.forEach(rodada => {
      html += `<div class="titulo-rodada" style="margin-top:20px;"><span>Rodada ${rodada}</span></div>`;
      porRodada[rodada].forEach(jogo => { html += htmlJogo(jogo); });
    });
    painel.innerHTML = html;

    // Repreenche palpites salvos nos novos inputs
    puxarPalpitesSalvos();
  }

  // 2. ENVIAR PALPITES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function enviarTodosPalpites() {
    const idUsuario = localStorage.getItem('craqueId') || localStorage.getItem('id_craque');
    if (!idUsuario) { mostrarAviso('VocÃª precisa estar logado para salvar seus palpites!', 'erro'); return; }

    const palpitesParaSalvar = [];
    jogosCarregados.forEach(jogo => {
      const inputCasa = document.getElementById(`casa_${jogo.id_jogo}`);
      const inputFora = document.getElementById(`fora_${jogo.id_jogo}`);
      if (inputCasa && inputFora && inputCasa.value !== '' && inputFora.value !== '') {
        palpitesParaSalvar.push({
          id_jogo:   jogo.id_jogo,
          id_usuario: idUsuario,
          gols_casa: parseInt(inputCasa.value),
          gols_fora: parseInt(inputFora.value)
        });
      }
    });

    if (!palpitesParaSalvar.length) {
      mostrarAviso('Preencha pelo menos um placar para salvar!', 'erro');
      return;
    }

    try {
      const resposta = await fetch('https://palpitoo-api.onrender.com/palpites', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ palpites: palpitesParaSalvar })
      });
      const resultado = await resposta.json();

      if (resposta.ok) {
        mostrarAviso(resultado.mensagem, 'sucesso');
        puxarPalpitesSalvos();
      } else {
        mostrarAviso(resultado.erro || 'Erro ao salvar.', 'erro');
      }
    } catch (err) {
      console.error(err);
      mostrarAviso('Servidor desligado! Verifique o terminal.', 'erro');
    }
  }

  // 3. LIMPAR INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function limparPalpites() {
    document.querySelectorAll('.input-placar:not(:disabled)').forEach(i => i.value = '');
    mostrarAviso('Palpites limpos.', 'info');
  }

  // 4. PUXAR PALPITES SALVOS E GERAR COMPROVANTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function puxarPalpitesSalvos() {
    const idUsuario = localStorage.getItem('craqueId') || localStorage.getItem('id_craque');
    if (!idUsuario) return;

    try {
      const resposta    = await fetch(`https://palpitoo-api.onrender.com/meus-palpites/${idUsuario}`);
      const meusPalpites = await resposta.json();
      const containerResumo = document.getElementById('resumo-palpites');
      containerResumo.innerHTML = '';

      if (!meusPalpites.length) {
        containerResumo.innerHTML =
          '<p class="text-center font-russo mt-10" style="color:var(--text-gray);">VocÃª ainda nÃ£o deu nenhum palpite.</p>';
        return;
      }

      // Preenche inputs para ediÃ§Ã£o
      meusPalpites.forEach(p => {
        const iCasa = document.getElementById(`casa_${p.jogo_id}`);
        const iFora = document.getElementById(`fora_${p.jogo_id}`);
        if (iCasa && iFora) { iCasa.value = p.gols_casa_palpite; iFora.value = p.gols_fora_palpite; }
      });

      // Agrupa comprovantes por rodada
      const porRodada = {};
      meusPalpites.forEach(p => {
        const jogo = jogosCarregados.find(j => j.id_jogo === p.jogo_id);
        if (!jogo) return;
        const r = jogo.rodada || 1;
        if (!porRodada[r]) porRodada[r] = [];
        porRodada[r].push({ palpite: p, jogo });
      });

      for (const rodada in porRodada) {
        containerResumo.innerHTML += `
          <div class="titulo-rodada">
            <span>Rodada ${rodada}</span>
          </div>`;

        porRodada[rodada].forEach(({ palpite, jogo }) => {
          const s = jogo.status.toLowerCase();

          // Badge de pontos (sÃ³ mostra se finalizado e tiver pontos)
          let ptsBadge = '';
          if (s === 'finalizado' && palpite.pontos_obtidos !== null && palpite.pontos_obtidos !== undefined) {
            if (palpite.pontos_obtidos === 3)      ptsBadge = '<span class="pontos-obtidos exato">ğŸ¯ +3pts â€” Exato!</span>';
            else if (palpite.pontos_obtidos === 1)  ptsBadge = '<span class="pontos-obtidos vencedor">âœ… +1pt â€” Vencedor</span>';
            else                                    ptsBadge = '<span class="pontos-obtidos errou">âŒ 0pts â€” Errou</span>';
          }

          containerResumo.innerHTML += `
            <div class="linha-jogo" style="margin-bottom:6px;">
              <span class="nome-time time-casa">${jogo.time_casa}</span>

              <div class="centro-comprovante">
                ${statusBadge(jogo.status)}
                <div class="area-placar">
                  <div class="placar-display">${palpite.gols_casa_palpite}</div>
                  <span class="versus">x</span>
                  <div class="placar-display">${palpite.gols_fora_palpite}</div>
                </div>
                ${ptsBadge}
              </div>

              <span class="nome-time time-fora">${jogo.time_fora}</span>
            </div>
            <hr class="divisor-jogo">`;
        });
      }

    } catch (err) {
      console.error('Erro ao puxar palpites:', err);
    }
  }

  carregarJogos();
</script>
<script src="main.js"></script>

<script>
    // Navbar: avatar + logout para pÃ¡ginas autenticadas
    (function() {
      const nome = localStorage.getItem('nome_craque') || '';
      const foto = localStorage.getItem('foto_craque');
      const userArea = document.getElementById('navbar-user-area');
      if (!userArea) return;
      if (nome) {
        const initials = encodeURIComponent(nome.split(' ')[0]);
        const src = (foto && foto !== 'null' && foto !== 'undefined')
          ? foto
          : `https://ui-avatars.com/api/?name=${initials}&background=7A1E3A&color=fff&size=36`;
        userArea.innerHTML = `
          <a href="perfil.html"><img src="${src}" alt="${nome}" class="navbar-avatar" title="${nome}" onerror="this.src='https://ui-avatars.com/api/?name=${initials}&background=7A1E3A&color=fff&size=36'"></a>
          <button class="btn-logout" onclick="fazerLogout()">Sair</button>
        `;
      } else {
        userArea.innerHTML = '<a href="login.html" class="btn-logout" style="border-color:var(--accent-cyan);color:var(--accent-cyan);">Entrar</a>';
      }
    })();

    function fazerLogout() {
      localStorage.clear();
      window.location.href = 'inicio.html';
    }

    // Hamburger menu
    document.addEventListener('DOMContentLoaded', function() {
      const btn = document.getElementById('hamburger-btn');
      const nav = document.querySelector('.nav-links');
      if (!btn || !nav) return;
      btn.addEventListener('click', function() {
        btn.classList.toggle('aberto');
        nav.classList.toggle('aberto');
      });
    });
  </script>
</body>
</html>