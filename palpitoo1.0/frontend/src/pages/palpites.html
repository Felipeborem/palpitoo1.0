<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Palpitoo - Palpites</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Salsa&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>

  <header class="cabecalho-palpitoo">
    <div class="logo-container">
      <div class="logo-circle"></div>
      <h1 class="logo-text font-russo">PalpitoO</h1>
    </div>
    <nav>
      <ul class="nav-links">
        <li><a href="index.html">Ligas</a></li>
        <li><a href="palpites.html" class="ativo">Palpites</a></li> <li><a href="#">Novidades</a></li>
        <li><a href="#">Social</a></li>
        <li><a href="#">Carreira</a></li>
        <li><a href="#">Ranking</a></li>
      </ul>
    </nav>
  </header>

  <main class="container-principal container-palpites">
    
    <section class="cartao bg-escuro cartao-palpite animacao-suave">
      
      <div class="cabecalho-palpite mb-20">
        <h2 class="font-russo titulo-branco text-center">Palpites Brah.bet</h2>
        <p class="subtitulo-tempo text-center">竢ｳ 3h atﾃｩ fim dos palpites</p>
      </div>


<!-- DIV PRINCIPAL DE LISTAS DE JOGOS-->
      <div class="lista-jogos" id="container-jogos">
        <p class="text-center text-white font-russo mt-10">Carregando jogos do banco de dados...</p>
      </div>

      <div class="botoes-acao mt-20">
        <button class="btn btn-cancelar font-russo" onclick="limparPalpites()">Limpar</button>
        <button class="btn btn-salvar font-russo" onclick="enviarTodosPalpites()">Salvar Palpites</button>
      </div>

    </section>

    <section class="cartao bg-escuro cartao-palpite animacao-suave">
      <div class="cabecalho-palpite mb-20">
        <h2 class="font-russo titulo-branco text-center">Palpites liga 2</h2>
        <p class="subtitulo-tempo text-center">竢ｳ 12h atﾃｩ fim dos palpites</p>
      </div>
      
      <div class="area-vazia">
        <p>Jogos ainda nﾃ｣o liberados.</p>
      </div>
    </section>

  </main>
<script>
  // Variﾃ｡vel global para lembrarmos quais jogos estﾃ｣o na tela
  let jogosCarregados = [];

  // 1. FUNﾃﾃグ QUE BUSCA E DESENHA OS JOGOS
  async function carregarJogos() {
    try {
      const resposta = await fetch('http://localhost:3000/jogos');
      jogosCarregados = await resposta.json();
      
      const container = document.getElementById('container-jogos');
      container.innerHTML = ''; // Limpa a mensagem de carregando

      if (jogosCarregados.length === 0) {
        container.innerHTML = '<p class="text-center text-white font-russo mt-10">Nenhum jogo liberado ainda.</p>';
        return;
      }

      // Desenha o HTML usando as SUAS classes CSS para cada jogo do banco
      jogosCarregados.forEach(jogo => {
        container.innerHTML += `
          <div class="linha-jogo">
            <span class="nome-time time-casa">${jogo.time_casa}</span>
            
            <div class="area-placar">
              <input type="number" id="casa_${jogo.id_jogo}" class="input-placar font-russo" placeholder="0" min="0">
              <span class="versus">x</span>
              <input type="number" id="fora_${jogo.id_jogo}" class="input-placar font-russo" placeholder="0" min="0">
            </div>
            
            <span class="nome-time time-fora text-left">${jogo.time_fora}</span>
          </div>
        `;
      });
    } catch (erro) {
      console.error("Erro ao buscar jogos:", erro);
      document.getElementById('container-jogos').innerHTML = '<p class="text-center text-red-500 font-russo mt-10">Erro ao conectar com o servidor.</p>';
    }
  }

  // 2. FUNﾃﾃグ QUE RECOLHE OS DADOS DIGITADOS
  async function enviarTodosPalpites() {
    // Puxa o ID do usuﾃ｡rio que guardamos no Login!
    const idUsuario = localStorage.getItem('craqueId'); 
    
    if (!idUsuario) {
      alert("Vocﾃｪ precisa estar logado para salvar seus palpites!");
      return;
    }

    const palpitesParaSalvar = [];

    // Passa por todos os jogos que estﾃ｣o na tela
    jogosCarregados.forEach(jogo => {
      const inputCasa = document.getElementById(`casa_${jogo.id_jogo}`).value;
      const inputFora = document.getElementById(`fora_${jogo.id_jogo}`).value;

      // Sﾃｳ cria o palpite se o cara digitou nﾃｺmeros nos dois campos
      if (inputCasa !== "" && inputFora !== "") {
        palpitesParaSalvar.push({
          id_jogo: jogo.id_jogo,
          id_usuario: idUsuario,
          gols_casa: parseInt(inputCasa),
          gols_fora: parseInt(inputFora)
        });
      }
    });

    if (palpitesParaSalvar.length === 0) {
      alert("Preencha pelo menos um placar para salvar!");
      return;
    }

    // Aqui ﾃｩ onde enviaremos pro servidor (faremos isso no prﾃｳximo passo)
    console.log("逃 Pacote de palpites pronto para envio:", palpitesParaSalvar);
    alert("Abra o F12 (Console) para ver os dados sendo capturados perfeitamente!");
  }

  // 3. FUNﾃﾃグ DO BOTﾃグ LIMPAR
  function limparPalpites() {
    const inputs = document.querySelectorAll('.input-placar');
    inputs.forEach(input => input.value = '');
  }

  // Aciona a busca de jogos assim que a pﾃ｡gina carrega
  carregarJogos();
</script>
</body>
</html>