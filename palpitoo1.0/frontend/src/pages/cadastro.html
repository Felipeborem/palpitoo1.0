<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Palpitoo - Cadastro de Craque</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Salsa&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>

  <main class="hero-section" style="justify-content: center; width: 100%;">
    <div class="login-area" style="justify-content: center; width: 100%;">
      
      <div class="login-card animacao-suave">
        <div class="login-header">
          <h3 class="font-russo" style="color: var(--accent-cyan);">Palpitoo</h3>
          <p>Crie sua conta na Arena</p>
        </div>
        
        <form id="meuFormulario">
          
          <div class="form-group" style="display: flex; flex-direction: column; align-items: center; text-align: center;">
            <img id="previewImagem" src="https://via.placeholder.com/80" alt="Preview" class="foto-perfil mb-10" style="width: 80px; height: 80px;">
            <label for="campoFoto" style="cursor: pointer; color: var(--accent-cyan); font-weight: bold; font-size: 14px; text-decoration: underline;">
              üì∏ Escolher Foto
            </label>
            <input type="file" id="campoFoto" accept="image/*" style="display: none;" onchange="prepararFoto()">
          </div>

          <div class="form-group">
            <label for="campoNome">Nome de Craque</label>
            <input id="campoNome" type="text" placeholder="Seu apelido na liga" required>
          </div>

          <div class="form-group">
            <label for="campoEmail">E-mail</label>
            <input id="campoEmail" type="email" placeholder="Seu melhor e-mail" required>
          </div>
          
          <div class="form-group">
            <label for="campoSenha">Senha</label>
            <input id="campoSenha" type="password" placeholder="Crie uma senha forte" required>
          </div>

          <div class="form-group">
            <label for="campoTime">Time do Cora√ß√£o</label>
            <input id="campoTime" type="text" placeholder="Ex: Galo..." required>
          </div>

          <button type="button" onclick="enviarDados()" class="btn-primary mt-10">
            Criar Minha Conta
          </button>
        </form>

        <div class="login-footer">
          J√° tem conta? <a href="login.html" class="btn-link">Entrar no Jogo</a>
        </div>
      </div>

    </div>
  </main>

  <script>
    let fotoBase64 = "";

    function prepararFoto() {
      const arquivo = document.getElementById('campoFoto').files[0];
      if (arquivo) {
        const reader = new FileReader();
        reader.onloadend = function() {
          fotoBase64 = reader.result; 
          document.getElementById('previewImagem').src = fotoBase64; 
        }
        reader.readAsDataURL(arquivo);
      }
    }

    async function enviarDados() {
      const nome = document.getElementById('campoNome').value;
      const email = document.getElementById('campoEmail').value;
      const senha = document.getElementById('campoSenha').value;
      const time_favorito = document.getElementById('campoTime').value;
      
      if (!nome || !email || !senha || !time_favorito) {
        alert("Preencha todos os campos para entrar em campo!");
        return;
      }

      try {
        const resposta = await fetch('http://localhost:3000/cadastro', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            nome: nome, 
            email: email, 
            senha: senha,
            time_favorito: time_favorito,
            foto_perfil: fotoBase64 
          })
        });

        const resultado = await resposta.json();

        if (resposta.ok) {
          alert("‚úÖ " + resultado.mensagem);
          
          document.getElementById('meuFormulario').reset();
          document.getElementById('previewImagem').src = "https://via.placeholder.com/80";
          fotoBase64 = ""; 
          window.location.href = 'login.html'; 
        } else {
          alert("‚ùå Ops: " + resultado.erro);
        }

      } catch (error) {
        console.error("Erro na conex√£o:", error);
        alert("Servidor desligado! Verifique se deu 'node server.js' no terminal.");
      }
    }
  </script>

</body>
</html>