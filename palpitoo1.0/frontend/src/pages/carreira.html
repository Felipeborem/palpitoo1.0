<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Palpitoo - Carreira</title>
  <link rel="stylesheet" href="./css/style.css">

  <style>
    /* â”€â”€ Abas â”€â”€ */
    .abas-carreira { display: flex; gap: 8px; margin-bottom: 28px; }
    .aba-btn {
      flex: 1; padding: 13px;
      font-family: 'Russo One', sans-serif; font-size: 13px;
      text-transform: uppercase;
      border: 1px solid var(--borda-divisoria); border-radius: 12px;
      cursor: pointer; background: var(--bg-dark); color: var(--text-gray);
      transition: all 0.2s ease;
    }
    .aba-btn.ativa { background: var(--accent-cyan); color: var(--text-white); border-color: var(--accent-cyan); }
    .painel-aba         { display: none; }
    .painel-aba.ativo   { display: block; }

    /* â”€â”€ Stat boxes â”€â”€ */
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px; margin-bottom: 20px;
    }
    .stat-box {
      background: var(--bg-dark); border: 1px solid var(--borda-divisoria);
      border-radius: 14px; padding: 16px 10px; text-align: center;
      transition: border-color 0.2s ease, transform 0.2s ease;
    }
    .stat-box:hover { border-color: var(--accent-cyan); transform: translateY(-2px); }
    .stat-valor { font-family: 'Russo One', sans-serif; font-size: 28px; color: var(--accent-cyan); }
    .stat-label { font-size: 10px; color: var(--text-gray); text-transform: uppercase; font-weight: 700; margin-top: 4px; line-height: 1.3; }

    /* â”€â”€ Barra de aproveitamento â”€â”€ */
    .barra-container { background: var(--bg-dark); border-radius: 20px; height: 10px; overflow: hidden; }
    .barra-fill {
      height: 100%; border-radius: 20px;
      background: linear-gradient(to right, var(--accent-green), var(--accent-cyan));
      width: 0%; transition: width 1s ease;
    }

    /* â”€â”€ Palpite item â”€â”€ */
    .palpite-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 11px 14px; background: var(--bg-dark); border-radius: 10px;
      margin-bottom: 8px; border: 1px solid var(--borda-divisoria);
      transition: border-color 0.2s ease;
    }
    .palpite-item:hover { border-color: var(--accent-cyan); }
    .palpite-jogo  { font-family: 'Russo One', sans-serif; font-size: 13px; color: var(--text-white); }
    .palpite-info  { font-size: 11px; color: var(--text-gray); margin-top: 2px; }
    .palpite-placar{ font-family: 'Russo One', sans-serif; font-size: 14px; color: var(--accent-cyan); }
    .palpite-pts   { font-family: 'Russo One', sans-serif; font-size: 13px; min-width: 52px; text-align: right; }
    .pts-3 { color: #4ade80; }
    .pts-1 { color: #eab308; }
    .pts-0 { color: #f87171; }

    /* â”€â”€ PosiÃ§Ã£o badge â”€â”€ */
    .posicao-destaque {
      display: inline-block; padding: 8px 22px; border-radius: 20px;
      font-family: 'Russo One', sans-serif; font-size: 14px;
      background: rgba(122,30,58,0.15); border: 1px solid var(--accent-cyan); color: var(--accent-cyan);
    }

    /* â”€â”€ TrofÃ©u card â”€â”€ */
    .trofeu-card {
      background: var(--bg-dark); border-radius: 14px; padding: 18px 12px;
      text-align: center; transition: all 0.2s ease; border: 1px solid var(--borda-divisoria);
    }
    .trofeu-card:hover { transform: translateY(-3px); }
    .trofeu-card.ouro    { border-color: #eab308; box-shadow: 0 0 15px rgba(234,179,8,0.1); }
    .trofeu-card.prata   { border-color: #d1d5db; }
    .trofeu-card.bronze  { border-color: #b45309; }
    .trofeu-card.especial{ border-color: var(--accent-cyan); }

    /* â”€â”€ Liga histÃ³rico â”€â”€ */
    .liga-hist-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 0; border-bottom: 1px dashed var(--borda-divisoria);
    }
    .liga-hist-item:last-child { border-bottom: none; }

    /* â”€â”€ Loading skeleton â”€â”€ */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-dark) 25%, rgba(255,255,255,0.04) 50%, var(--bg-dark) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.2s infinite;
      border-radius: 8px; height: 28px;
    }
    @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
  </style>
  <meta name="description" content="Palpitoo â€” A Resenha Virou Campeonato. Palpites de futebol com amigos.">
  <link rel="icon" href="./img/pato.png" type="image/png">
</head>
<body>

  <header class="navbar">
    <a href="index.html" class="logo-link">
      <img src="./img/pato.png" alt="Logo Palpitoo" class="logo-imagem">
    </a>
    <nav>
      <ul class="nav-links">
        <li><a href="index.html">InÃ­cio</a></li>
        <li><a href="ligas.html">Ligas</a></li>
        <li><a href="palpites.html">Palpites</a></li>
        <li><a href="novidades.html">Novidades</a></li>
        <li><a href="social.html">Social</a></li>
        <li><a href="carreira.html" class="ativo">Carreira</a></li>
      </ul>
    </nav>
    <button class="hamburger" id="hamburger-btn" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <div class="navbar-user" id="navbar-user-area"></div>
  </header>

  <main class="container-principal" style="margin-top: 40px;">

    <!-- â•â• TOPO: IDENTIDADE â•â• -->
    <section class="cartao bg-escuro animacao-suave text-center mb-20"
             style="position:relative;overflow:hidden;border:1px solid var(--accent-cyan);">
      <div style="position:absolute;top:-50px;right:-50px;font-size:150px;opacity:0.03;pointer-events:none;">ğŸ‘‘</div>

      <div style="display:flex;flex-direction:column;align-items:center;gap:10px;">
        <img id="fotoPerfil"
             src="https://ui-avatars.com/api/?name=?&background=random&size=100"
             alt="Foto" class="foto-perfil"
             style="width:100px;height:100px;border-color:var(--accent-cyan);border-width:3px;border-radius:50%;object-fit:cover;">
        <h2 id="nomeUsuario" class="font-russo titulo-branco" style="font-size:28px;margin:0;">Carregando...</h2>
        <p id="timeUsuario" style="color:var(--text-gray);font-size:14px;margin:0;text-transform:uppercase;">â€”</p>

        <div style="display:flex;gap:16px;margin-top:8px;flex-wrap:wrap;justify-content:center;">
          <div style="background:var(--bg-dark);padding:8px 20px;border-radius:20px;border:1px solid var(--borda-divisoria);">
            <span class="font-russo" style="color:var(--accent-green);font-size:14px;">
              Carreira: <span id="totalCarreira">â€” pts</span>
            </span>
          </div>
          <div style="background:var(--bg-dark);padding:8px 20px;border-radius:20px;border:1px solid var(--borda-divisoria);">
            <span class="font-russo" style="color:var(--accent-cyan);font-size:14px;">
              Temporada: <span id="totalTemporada">â€” pts</span>
            </span>
          </div>
        </div>
      </div>

      <a href="perfil.html" class="btn-link" style="display:inline-block;margin-top:15px;font-size:12px;color:var(--text-gray);">
        âš™ï¸ ConfiguraÃ§Ãµes da Conta
      </a>
    </section>

    <!-- â•â• ABAS â•â• -->
    <div class="abas-carreira">
      <button class="aba-btn ativa" id="aba-btn-temporada" onclick="trocarAba('temporada')">âš¡ Temporada Atual</button>
      <button class="aba-btn"       id="aba-btn-carreira"  onclick="trocarAba('carreira')">ğŸ“œ Carreira Completa</button>
    </div>

    <!-- â•â• ABA: TEMPORADA ATUAL â•â• -->
    <div id="painel-temporada" class="painel-aba ativo">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:24px;">

        <!-- Desempenho -->
        <section class="cartao bg-escuro animacao-suave">
          <h3 class="font-russo titulo-branco mb-15" style="font-size:18px;">ğŸ“Š Desempenho Atual</h3>
          <div class="divisor-tracejado mb-20"></div>

          <div class="stat-grid">
            <div class="stat-box"><div class="stat-valor" id="t-pontos">â€”</div><div class="stat-label">Pontos</div></div>
            <div class="stat-box"><div class="stat-valor" id="t-cravadas">â€”</div><div class="stat-label">CravaÃ§Ãµes ğŸ¯</div></div>
            <div class="stat-box"><div class="stat-valor" id="t-acertos">â€”</div><div class="stat-label">Acertos âœ…</div></div>
            <div class="stat-box"><div class="stat-valor" id="t-erros">â€”</div><div class="stat-label">Erros âŒ</div></div>
            <div class="stat-box"><div class="stat-valor" id="t-palpites">â€”</div><div class="stat-label">Palpites feitos</div></div>
            <div class="stat-box"><div class="stat-valor" id="t-aproveitamento">â€”%</div><div class="stat-label">Aproveitamento</div></div>
          </div>

          <div style="background:var(--bg-dark);border:1px solid var(--borda-divisoria);border-radius:12px;padding:14px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
              <span style="font-family:'Russo One',sans-serif;font-size:12px;color:var(--text-gray);">Taxa de acerto</span>
              <span style="font-family:'Russo One',sans-serif;font-size:12px;color:var(--accent-cyan);" id="t-taxa-label">â€”%</span>
            </div>
            <div class="barra-container"><div class="barra-fill" id="t-barra"></div></div>
            <p id="t-frase" style="font-size:12px;color:var(--text-gray);margin-top:8px;text-align:center;font-family:'Russo One',sans-serif;">Calculando...</p>
          </div>
        </section>

        <div style="display:flex;flex-direction:column;gap:24px;">

          <!-- PosiÃ§Ã£o na liga -->
          <section class="cartao bg-escuro animacao-suave">
            <h3 class="font-russo titulo-branco mb-15" style="font-size:18px;">ğŸ† PosiÃ§Ã£o na Liga</h3>
            <div class="divisor-tracejado mb-20"></div>
            <div style="text-align:center;padding:10px 0;">
              <div style="font-size:52px;margin-bottom:10px;" id="t-posicao-icone">â€”</div>
              <span class="posicao-destaque" id="t-posicao-texto">Carregando...</span>
              <p style="color:var(--text-gray);font-size:12px;margin-top:10px;" id="t-nome-liga">â€”</p>
            </div>
          </section>

          <!-- Ãšltimos palpites -->
          <section class="cartao bg-escuro animacao-suave">
            <h3 class="font-russo titulo-branco mb-15" style="font-size:18px;">ğŸ• Ãšltimos Palpites</h3>
            <div class="divisor-tracejado mb-20"></div>
            <div id="lista-ultimos">
              <p class="text-center" style="color:var(--text-gray);font-size:13px;">Carregando...</p>
            </div>
          </section>

        </div>
      </div>
    </div>

    <!-- â•â• ABA: CARREIRA COMPLETA â•â• -->
    <div id="painel-carreira" class="painel-aba">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:24px;">

        <!-- Stats totais -->
        <section class="cartao bg-escuro animacao-suave">
          <h3 class="font-russo titulo-branco mb-15" style="font-size:18px;">ğŸ“ˆ NÃºmeros da Carreira</h3>
          <div class="divisor-tracejado mb-20"></div>

          <div class="stat-grid">
            <div class="stat-box"><div class="stat-valor" id="c-pontos">â€”</div><div class="stat-label">Pontos Totais</div></div>
            <div class="stat-box"><div class="stat-valor" id="c-palpites">â€”</div><div class="stat-label">Total Palpites</div></div>
            <div class="stat-box"><div class="stat-valor" id="c-ligas">â€”</div><div class="stat-label">Ligas Jogadas</div></div>
            <div class="stat-box"><div class="stat-valor" id="c-cravadas">â€”</div><div class="stat-label">CravaÃ§Ãµes ğŸ¯</div></div>
            <div class="stat-box"><div class="stat-valor" id="c-acertos">â€”</div><div class="stat-label">Acertos âœ…</div></div>
            <div class="stat-box"><div class="stat-valor" id="c-aproveitamento">â€”%</div><div class="stat-label">Aproveitamento</div></div>
          </div>

          <div style="background:var(--bg-dark);border:1px solid var(--borda-divisoria);border-radius:12px;padding:14px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
              <span style="font-family:'Russo One',sans-serif;font-size:12px;color:var(--text-gray);">Aproveitamento histÃ³rico</span>
              <span style="font-family:'Russo One',sans-serif;font-size:12px;color:var(--accent-cyan);" id="c-taxa-label">â€”%</span>
            </div>
            <div class="barra-container"><div class="barra-fill" id="c-barra"></div></div>
            <p id="c-frase" style="font-size:12px;color:var(--text-gray);margin-top:8px;text-align:center;font-family:'Russo One',sans-serif;">Calculando...</p>
          </div>
        </section>

        <div style="display:flex;flex-direction:column;gap:24px;">

          <!-- Sala de trofÃ©us -->
          <section class="cartao bg-escuro animacao-suave">
            <h3 class="font-russo titulo-branco mb-15" style="font-size:18px;">ğŸ… Sala de TrofÃ©us</h3>
            <div class="divisor-tracejado mb-20"></div>
            <div id="sala-trofeus" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
              <p class="text-center" style="color:var(--text-gray);font-size:13px;grid-column:span 2;">Carregando...</p>
            </div>
          </section>

          <!-- HistÃ³rico de ligas -->
          <section class="cartao bg-escuro animacao-suave">
            <h3 class="font-russo titulo-branco mb-15" style="font-size:18px;">ğŸ“œ HistÃ³rico de Ligas</h3>
            <div class="divisor-tracejado mb-20"></div>
            <div id="historico-ligas">
              <p class="text-center" style="color:var(--text-gray);font-size:13px;">Carregando...</p>
            </div>
          </section>

        </div>
      </div>
    </div>

  </main>

  <div id="container-avisos"></div>

<script>
  const API     = 'https://palpitoo-api.onrender.com';
  const idLogado   = localStorage.getItem('craqueId') || localStorage.getItem('id_craque');
  const nomeLogado = localStorage.getItem('nome_craque');
  const timeLogado = localStorage.getItem('time_craque');
  const fotoLogada = localStorage.getItem('foto_craque');

  // â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function mostrarAviso(msg, tipo = 'info') {
    const cont  = document.getElementById('container-avisos');
    const toast = document.createElement('div');
    const icone = tipo === 'sucesso' ? 'âœ…' : tipo === 'erro' ? 'âŒ' : 'â„¹ï¸';
    toast.className = `aviso-toast aviso-${tipo}`;
    toast.innerHTML = `<span>${icone}</span><span>${msg}</span>`;
    cont.appendChild(toast);
    setTimeout(() => { toast.classList.add('aviso-saindo'); setTimeout(() => toast.remove(), 300); }, 3000);
  }

  // â”€â”€ PREENCHE TOPO COM DADOS DO LOCALSTORAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener('DOMContentLoaded', () => {
    if (nomeLogado) {
      document.getElementById('nomeUsuario').innerText = nomeLogado;
      document.getElementById('fotoPerfil').src =
        `https://ui-avatars.com/api/?name=${encodeURIComponent(nomeLogado)}&background=random&size=100`;
    }
    if (timeLogado && timeLogado !== 'undefined' && timeLogado !== 'null') {
      document.getElementById('timeUsuario').innerText = `âš½ ${timeLogado}`;
    }
    if (fotoLogada && fotoLogada !== 'undefined' && fotoLogada !== 'null') {
      document.getElementById('fotoPerfil').src = fotoLogada;
    }
    if (!idLogado) {
      mostrarAviso('VocÃª nÃ£o estÃ¡ logado â€” exibindo prÃ©via.', 'info');
      carregarPreviewTemporada();
      carregarPreviewCarreira();
    }
  });

  // â”€â”€ TROCAR ABA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function trocarAba(qual) {
    document.getElementById('painel-temporada').classList.toggle('ativo', qual === 'temporada');
    document.getElementById('painel-carreira').classList.toggle('ativo', qual === 'carreira');
    document.getElementById('aba-btn-temporada').classList.toggle('ativa', qual === 'temporada');
    document.getElementById('aba-btn-carreira').classList.toggle('ativa', qual === 'carreira');
  }

  // â”€â”€ FRASE DE APROVEITAMENTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function fraseAproveitamento(taxa) {
    if (taxa >= 70) return 'ğŸ”¥ TÃ¡ voando!';
    if (taxa >= 50) return 'ğŸ‘ Bom desempenho';
    if (taxa >= 30) return 'ğŸ˜ Na mÃ©dia...';
    return 'ğŸ¦† Pato master';
  }

  // â”€â”€ TEMPORADA ATUAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function carregarTemporada() {
    if (!idLogado) return;

    try {
      // 1. Palpites do usuÃ¡rio
      const [resPalpites, resJogos] = await Promise.all([
        fetch(`${API}/meus-palpites/${idLogado}`),
        fetch(`${API}/jogos`)
      ]);
      const palpites = await resPalpites.json();
      const jogos    = await resJogos.json();

      // Calcula stats sobre palpites finalizados
      const finalizados  = palpites.filter(p => p.pontos_obtidos !== null);
      const pontos       = finalizados.reduce((s, p) => s + Number(p.pontos_obtidos), 0);
      const cravadas     = finalizados.filter(p => Number(p.pontos_obtidos) === 3).length;
      const acertos      = finalizados.filter(p => Number(p.pontos_obtidos) === 1).length;
      const erros        = finalizados.filter(p => Number(p.pontos_obtidos) === 0).length;
      const taxa         = finalizados.length > 0
        ? Math.round(((cravadas + acertos) / finalizados.length) * 100) : 0;

      document.getElementById('t-pontos').innerText         = pontos;
      document.getElementById('t-cravadas').innerText       = cravadas;
      document.getElementById('t-acertos').innerText        = acertos;
      document.getElementById('t-erros').innerText          = erros;
      document.getElementById('t-palpites').innerText       = palpites.length;
      document.getElementById('t-aproveitamento').innerText = `${taxa}%`;
      document.getElementById('t-taxa-label').innerText     = `${taxa}%`;
      document.getElementById('t-frase').innerText          = fraseAproveitamento(taxa);
      document.getElementById('totalTemporada').innerText   = `${pontos} pts`;
      setTimeout(() => { document.getElementById('t-barra').style.width = `${taxa}%`; }, 100);

      // 2. PosiÃ§Ã£o na liga
      const resLigas = await fetch(`${API}/minhas-ligas/${idLogado}`);
      const ligas    = await resLigas.json();

      if (Array.isArray(ligas) && ligas.length > 0) {
        const liga     = ligas[0];
        const resRank  = await fetch(`${API}/ranking-liga/${liga.id_liga}`);
        const dadosLiga = await resRank.json();
        const ranking  = dadosLiga.ranking || [];

        document.getElementById('t-nome-liga').innerText = dadosLiga.nomeLiga || liga.nome;

        const pos = ranking.findIndex(r => String(r.id) === String(idLogado));
        if (pos !== -1) {
          const medalhas = { 0: 'ğŸ¥‡', 1: 'ğŸ¥ˆ', 2: 'ğŸ¥‰' };
          document.getElementById('t-posicao-icone').innerText = medalhas[pos] || 'ğŸ…';
          document.getElementById('t-posicao-texto').innerText = `${pos + 1}Âº lugar`;
        } else {
          document.getElementById('t-posicao-icone').innerText = 'ğŸ…';
          document.getElementById('t-posicao-texto').innerText = 'Sem pontos ainda';
        }
      } else {
        document.getElementById('t-posicao-icone').innerText = 'ğŸ¦†';
        document.getElementById('t-posicao-texto').innerText = 'Sem liga';
        document.getElementById('t-nome-liga').innerText     = 'Entre em uma liga!';
      }

      // 3. Ãšltimos 6 palpites
      const lista = document.getElementById('lista-ultimos');
      lista.innerHTML = '';

      const palpitesComJogo = palpites
        .map(p => ({ ...p, jogo: jogos.find(j => j.id_jogo === p.jogo_id) }))
        .filter(p => p.jogo)
        .slice(-6)
        .reverse();

      if (!palpitesComJogo.length) {
        lista.innerHTML = '<p class="text-center" style="color:var(--text-gray);font-size:13px;">Nenhum palpite feito ainda.</p>';
      } else {
        palpitesComJogo.forEach(p => {
          const pts      = p.pontos_obtidos !== null ? Number(p.pontos_obtidos) : null;
          const ptsCls   = pts === 3 ? 'pts-3' : pts === 1 ? 'pts-1' : pts === 0 ? 'pts-0' : '';
          const ptsLabel = pts === 3 ? 'ğŸ¯ +3' : pts === 1 ? 'âœ… +1' : pts === 0 ? 'âŒ 0' : 'â³ â€”';
          const resultado = p.jogo.status === 'finalizado' && p.jogo.gols_casa_real !== null
            ? `<span style="font-size:10px;color:var(--text-gray);">Real: ${p.jogo.gols_casa_real}x${p.jogo.gols_fora_real}</span>`
            : `<span style="font-size:10px;color:var(--accent-cyan);">${p.jogo.status === 'em andamento' ? 'ğŸŸ¡ Em andamento' : 'ğŸŸ¢ Aberto'}</span>`;

          lista.innerHTML += `
            <div class="palpite-item">
              <div>
                <p class="palpite-jogo">${p.jogo.time_casa} x ${p.jogo.time_fora}</p>
                <p class="palpite-info">Rod. ${p.jogo.rodada || 1} Â· ${resultado}</p>
              </div>
              <span class="palpite-placar">${p.gols_casa_palpite} x ${p.gols_fora_palpite}</span>
              <span class="palpite-pts ${ptsCls}">${ptsLabel}</span>
            </div>`;
        });
      }

    } catch (e) {
      console.error('Erro ao carregar temporada:', e);
      mostrarAviso('Erro ao carregar dados da temporada.', 'erro');
      carregarPreviewTemporada();
    }
  }

  // â”€â”€ CARREIRA COMPLETA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function carregarCarreira() {
    if (!idLogado) return;

    try {
      // Stats totais
      const resPalpites = await fetch(`${API}/meus-palpites/${idLogado}`);
      const palpites    = await resPalpites.json();

      const finalizados  = palpites.filter(p => p.pontos_obtidos !== null);
      const pontos       = finalizados.reduce((s, p) => s + Number(p.pontos_obtidos), 0);
      const cravadas     = finalizados.filter(p => Number(p.pontos_obtidos) === 3).length;
      const acertos      = finalizados.filter(p => Number(p.pontos_obtidos) === 1).length;
      const taxa         = finalizados.length > 0
        ? Math.round(((cravadas + acertos) / finalizados.length) * 100) : 0;

      document.getElementById('c-pontos').innerText         = pontos;
      document.getElementById('c-palpites').innerText       = finalizados.length;
      document.getElementById('c-cravadas').innerText       = cravadas;
      document.getElementById('c-acertos').innerText        = acertos;
      document.getElementById('c-aproveitamento').innerText = `${taxa}%`;
      document.getElementById('c-taxa-label').innerText     = `${taxa}%`;
      document.getElementById('c-frase').innerText          = fraseAproveitamento(taxa);
      document.getElementById('totalCarreira').innerText    = `${pontos} pts`;
      setTimeout(() => { document.getElementById('c-barra').style.width = `${taxa}%`; }, 200);

      // Ligas jogadas
      const resLigas = await fetch(`${API}/minhas-ligas/${idLogado}`);
      const ligas    = await resLigas.json();
      document.getElementById('c-ligas').innerText = Array.isArray(ligas) ? ligas.length : 0;

      const trofeus   = document.getElementById('sala-trofeus');
      const histLigas = document.getElementById('historico-ligas');
      trofeus.innerHTML   = '';
      histLigas.innerHTML = '';

      if (!Array.isArray(ligas) || !ligas.length) {
        trofeus.innerHTML   = '<p class="text-center" style="color:var(--text-gray);font-size:13px;grid-column:span 2;">Nenhum trofÃ©u ainda. ğŸ¦†</p>';
        histLigas.innerHTML = '<p class="text-center" style="color:var(--text-gray);font-size:13px;">VocÃª ainda nÃ£o participou de nenhuma liga.</p>';
        return;
      }

      const trofeusList = [];

      for (const liga of ligas) {
        const resRank   = await fetch(`${API}/ranking-liga/${liga.id_liga}`);
        const dadosLiga = await resRank.json();
        const ranking   = dadosLiga.ranking || [];
        const pos       = ranking.findIndex(r => String(r.id) === String(idLogado));
        const meuPts    = pos !== -1 ? ranking[pos].total_pontos : 0;
        const posicao   = pos !== -1 ? pos + 1 : null;

        const corPos   = posicao === 1 ? '#eab308' : posicao === 2 ? '#d1d5db' : posicao === 3 ? '#b45309' : 'var(--accent-cyan)';
        const labelPos = posicao === 1 ? 'ğŸ† CampeÃ£o' : posicao === 2 ? 'ğŸ¥ˆ Vice' : posicao === 3 ? 'ğŸ¥‰ 3Âº Lugar'
          : posicao ? `${posicao}Âº Lugar` : 'â€”';

        histLigas.innerHTML += `
          <div class="liga-hist-item">
            <div>
              <p class="font-russo" style="font-size:14px;color:var(--text-white);">${liga.nome}</p>
              <p style="font-size:11px;color:var(--text-gray);">Liga Privada Â· CÃ³d: ${liga.codigo_convite}</p>
            </div>
            <div style="text-align:right;">
              <p class="font-russo" style="font-size:15px;color:${corPos};">${labelPos}</p>
              <p style="font-size:12px;color:var(--accent-cyan);">${meuPts} pts</p>
            </div>
          </div>`;

        if (posicao && posicao <= 3) trofeusList.push({ posicao, nome: liga.nome });
      }

      // TrofÃ©us
      if (!trofeusList.length) {
        trofeus.innerHTML = '<p class="text-center" style="color:var(--text-gray);font-size:13px;grid-column:span 2;">Nenhum trofÃ©u ainda. Continue lutando! ğŸ¦†</p>';
      } else {
        const config = {
          1: { icone: 'ğŸ†', cor: 'ouro',   label: 'CAMPEÃƒO'  },
          2: { icone: 'ğŸ¥ˆ', cor: 'prata',  label: 'VICE'     },
          3: { icone: 'ğŸ¥‰', cor: 'bronze', label: '3Âº LUGAR' }
        };
        trofeusList.forEach(t => {
          const c = config[t.posicao];
          trofeus.innerHTML += `
            <div class="trofeu-card ${c.cor}">
              <div style="font-size:40px;margin-bottom:10px;">${c.icone}</div>
              <p class="font-russo" style="font-size:13px;color:var(--text-white);margin-bottom:4px;">${t.nome}</p>
              <p style="color:var(--text-gray);font-size:10px;font-weight:bold;">${c.label}</p>
            </div>`;
        });
      }

      // TrofÃ©u especial: Rei das CravaÃ§Ãµes (5+)
      if (cravadas >= 5) {
        trofeus.innerHTML += `
          <div class="trofeu-card especial" style="grid-column:span 2;">
            <div style="font-size:36px;margin-bottom:8px;">ğŸ¯</div>
            <p class="font-russo" style="font-size:13px;color:var(--accent-cyan);margin-bottom:4px;">Rei das CravaÃ§Ãµes</p>
            <p style="color:var(--text-gray);font-size:10px;font-weight:bold;">${cravadas} PLACARES EXATOS NA CARREIRA</p>
          </div>`;
      }

    } catch (e) {
      console.error('Erro ao carregar carreira:', e);
      mostrarAviso('Erro ao carregar dados da carreira.', 'erro');
      carregarPreviewCarreira();
    }
  }

  // â”€â”€ PREVIEW TEMPORADA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function carregarPreviewTemporada() {
    document.getElementById('t-pontos').innerText         = '24';
    document.getElementById('t-cravadas').innerText       = '3';
    document.getElementById('t-acertos').innerText        = '5';
    document.getElementById('t-erros').innerText          = '4';
    document.getElementById('t-palpites').innerText       = '12';
    document.getElementById('t-aproveitamento').innerText = '67%';
    document.getElementById('t-taxa-label').innerText     = '67%';
    document.getElementById('t-frase').innerText          = 'ğŸ”¥ TÃ¡ voando!';
    document.getElementById('totalTemporada').innerText   = '24 pts';
    document.getElementById('t-posicao-icone').innerText  = 'ğŸ¥ˆ';
    document.getElementById('t-posicao-texto').innerText  = '2Âº lugar';
    document.getElementById('t-nome-liga').innerText      = 'Liga dos Bagres';
    setTimeout(() => { document.getElementById('t-barra').style.width = '67%'; }, 100);

    const lista = document.getElementById('lista-ultimos');
    [
      { jogo: 'FLA x SAN', rod: 3, palpite: '2 x 1', real: '2 x 1', pts: 3 },
      { jogo: 'SPF x CRU', rod: 3, palpite: '1 x 0', real: '2 x 0', pts: 1 },
      { jogo: 'PAL x GRE', rod: 2, palpite: '0 x 1', real: '1 x 0', pts: 0 },
    ].forEach(d => {
      const cls = d.pts === 3 ? 'pts-3' : d.pts === 1 ? 'pts-1' : 'pts-0';
      const lbl = d.pts === 3 ? 'ğŸ¯ +3' : d.pts === 1 ? 'âœ… +1' : 'âŒ 0';
      lista.innerHTML += `
        <div class="palpite-item">
          <div><p class="palpite-jogo">${d.jogo}</p><p class="palpite-info">Rod. ${d.rod} Â· Real: ${d.real}</p></div>
          <span class="palpite-placar">${d.palpite}</span>
          <span class="palpite-pts ${cls}">${lbl}</span>
        </div>`;
    });
  }

  // â”€â”€ PREVIEW CARREIRA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function carregarPreviewCarreira() {
    document.getElementById('c-pontos').innerText         = '142';
    document.getElementById('c-palpites').innerText       = '38';
    document.getElementById('c-ligas').innerText          = '3';
    document.getElementById('c-cravadas').innerText       = '12';
    document.getElementById('c-acertos').innerText        = '15';
    document.getElementById('c-aproveitamento').innerText = '71%';
    document.getElementById('c-taxa-label').innerText     = '71%';
    document.getElementById('c-frase').innerText          = 'ğŸ”¥ TÃ¡ voando!';
    document.getElementById('totalCarreira').innerText    = '142 pts';
    setTimeout(() => { document.getElementById('c-barra').style.width = '71%'; }, 200);

    document.getElementById('sala-trofeus').innerHTML = `
      <div class="trofeu-card ouro">
        <div style="font-size:40px;margin-bottom:10px;">ğŸ†</div>
        <p class="font-russo" style="font-size:13px;color:#eab308;margin-bottom:4px;">Liga dos Bagres</p>
        <p style="color:var(--text-gray);font-size:10px;font-weight:bold;">CAMPEÃƒO</p>
      </div>
      <div class="trofeu-card especial" style="grid-column:span 2;">
        <div style="font-size:36px;margin-bottom:8px;">ğŸ¯</div>
        <p class="font-russo" style="font-size:13px;color:var(--accent-cyan);margin-bottom:4px;">Rei das CravaÃ§Ãµes</p>
        <p style="color:var(--text-gray);font-size:10px;font-weight:bold;">12 PLACARES EXATOS NA CARREIRA</p>
      </div>`;

    document.getElementById('historico-ligas').innerHTML = `
      <div class="liga-hist-item">
        <div><p class="font-russo" style="font-size:14px;color:var(--text-white);">Liga dos Bagres</p><p style="font-size:11px;color:var(--text-gray);">Liga Privada</p></div>
        <div style="text-align:right;"><p class="font-russo" style="font-size:15px;color:#eab308;">ğŸ† CampeÃ£o</p><p style="font-size:12px;color:var(--accent-cyan);">45 pts</p></div>
      </div>`;
  }

  // â”€â”€ INICIAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  carregarTemporada();
  carregarCarreira();
</script>


  <script>
    // Navbar: avatar + logout para pÃ¡ginas autenticadas
    (function() {
      const nome = localStorage.getItem('nome_craque') || '';
      const foto = localStorage.getItem('foto_craque');
      const userArea = document.getElementById('navbar-user-area');
      if (!userArea) return;
      if (nome) {
        const initials = encodeURIComponent(nome.split(' ')[0]);
        const src = (foto && foto !== 'null' && foto !== 'undefined')
          ? foto
          : `https://ui-avatars.com/api/?name=${initials}&background=7A1E3A&color=fff&size=36`;
        userArea.innerHTML = `
          <a href="perfil.html"><img src="${src}" alt="${nome}" class="navbar-avatar" title="${nome}" onerror="this.src='https://ui-avatars.com/api/?name=${initials}&background=7A1E3A&color=fff&size=36'"></a>
          <button class="btn-logout" onclick="fazerLogout()">Sair</button>
        `;
      } else {
        userArea.innerHTML = '<a href="login.html" class="btn-logout" style="border-color:var(--accent-cyan);color:var(--accent-cyan);">Entrar</a>';
      }
    })();

    function fazerLogout() {
      localStorage.clear();
      window.location.href = 'inicio.html';
    }

    // Hamburger menu
    document.addEventListener('DOMContentLoaded', function() {
      const btn = document.getElementById('hamburger-btn');
      const nav = document.querySelector('.nav-links');
      if (!btn || !nav) return;
      btn.addEventListener('click', function() {
        btn.classList.toggle('aberto');
        nav.classList.toggle('aberto');
      });
    });
  </script>

</body>
</html>